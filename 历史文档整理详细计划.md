# 历史文档整理详细计划

## 现状分析

### 根目录待处理文件/文件夹
！！！！！！！！！！！！注意，prompot文件有些并没有用上！！
并不是所有文件都跟我们历史尝试有关的。
1. **prompts/** - 6个prompt文件
   - 解题Prompt.md
   - 判题Prompt.md  
   - 生成题Prompt.md
   - 生成题Prompt_higherlever.md
   - 新prompt.md (可能在根目录重复)
   - 质量检查prompt.md (可能在根目录重复)

2. **question_all/** - 301个文件
   - 需要分析是哪次尝试产生的

3. **question_all_md/** - 未统计
   - 需要确认用途和归属

### 辅助脚本分析(从读取结果)

#### 已分析的3个脚本:

1. **analyze_questions.py**
   ```python
   # 用途: 分析question_all目录数据
   # 读取: question_all/*/pass.json + not_pass.json
   # 结论: 属于question_all的统计工具
   ```

2. **batch_auto_run.py**  
   ```python
   # 用途: 批量处理298个txt文件,生成1490道详细问题
   # 输入: compliant/
   # 输出: questions/  
   # 引用: batch_detail_q_generator.py
   # 结论: 属于"04_详细题目生成"尝试
   ```

3. **run_full_batch.py**
   ```python
   # 用途: 批量处理298个txt文件,全速运行
   # 输入: compliant/
   # 输出: questions/
   # 引用: batch_detail_q_generator.py
   # 结论: 属于"04_详细题目生成"尝试
   ```

#### 已分析的全部13个脚本:

| 脚本名称 | 用途 | 归属 |
|---------|------|------|
| **analyze_questions.py** | 分析question_all数据统计 | 📊 question_all的统计工具 |
| **batch_auto_run.py** | 批量处理298个txt,生成1490题 | 🔧 04_详细题目生成 |
| **run_full_batch.py** | 批量处理298个txt,全速模式 | 🔧 04_详细题目生成 |
| **run_batch_detail_q.py** | 快速启动批量处理 | 🔧 04_详细题目生成 |
| **batch_restart.py** | 重启批处理,清理失败任务 | 🔧 04_详细题目生成 |
| **monitor_batch.py** | 实时监控批处理进度 | 🔧 04_详细题目生成 |
| **test_batch_2files.py** | 测试批处理(仅2文件) | 🔧 04_详细题目生成 |
| **extract_questions_to_md.py** | 从question_all提取为MD | 📊 question_all的导出工具 |
| **organize_question_dirs.py** | 整理旧questions目录 | 🧹 我们写的整理脚本 |
| **consolidate_and_complete.py** | 合并所有问题到question_all | 🔀 question_all的合并工具 |
| **archive_history.py** | 旧版历史归档脚本(805行) | 🧹 我们写的整理脚本(旧版) |
| **archive_history_complete.py** | 完善版历史归档脚本(820行) | 🧹 我们写的整理脚本(新版) |
| **organize_root.py** | 整理根目录文件(193行) | 🧹 我们写的整理脚本 |

## 整理方案

### 第1步: 继续读取剩余脚本

依次读取以下10个脚本,判断归属:

1. organize_question_dirs.py - 可能是整理问题目录的工具
2. extract_questions_to_md.py - 可能是question_all_md的生成工具
3. run_batch_detail_q.py - 可能是batch_auto_run的变体
4. monitor_batch.py - 可能是批量处理的监控工具
5. batch_restart.py - 可能是批量处理失败重启工具
6. test_batch_2files.py - 测试脚本
7. consolidate_and_complete.py - 可能是数据合并工具
8. archive_history.py - 可能是旧的归档脚本(我们写的)
9. archive_history_complete.py - 可能是完整归档脚本(我们写的)
10. organize_root.py - 可能是根目录整理脚本(我们写的)

### 第2步: 移动辅助脚本到对应尝试

根据分析结果,将脚本移动到:
- `历史尝试归档/04_详细题目生成/辅助脚本/` (batch相关)
- `历史尝试归档/XX_对应尝试/辅助脚本/` (其他脚本)
- `历史尝试归档/00_根目录旧文件/整理脚本/` (我们自己写的整理工具)

### 第3步: 分析question_all归属

**已完成分析**:
- question_id前缀: `batch_detail_q_*`
- generation_model: `openai/Pro/deepseek-ai/DeepSeek-V3`
- **结论**: 属于 **04_第四次尝试_详细问题** (详细题目生成阶段)

question_all目录包含:
- 301个文件夹(每个txt文件对应一个文件夹)
- 每个文件夹有pass.json和not_pass.json
- 这是consolidate_and_complete.py合并后的最终结果

**question_all_md目录**:
- 由extract_questions_to_md.py生成
- 从question_all的JSON转换为Markdown格式
- 便于人类阅读

### 第4步: 移动question目录

根据分析结果移动到对应的尝试文件夹:
- question_all → `历史尝试归档/XX_对应尝试/题目数据/`
- question_all_md → `历史尝试归档/XX_对应尝试/题目数据_md格式/`

### 第5步: 整理prompts目录

**prompts/目录内容** (4个文件，根目录还有2个):
1. `解题Prompt.md` (0.4 KB) - 答题阶段的prompt
2. `判题Prompt.md` (1.5 KB) - 判题阶段的prompt
3. `生成题Prompt.md` (2.4 KB) - 基础生成prompt
4. `生成题Prompt_higherlever.md` (3.3 KB) - 高级生成prompt

**根目录还有2个**:
- `新prompt.md` - 需要判断版本
- `质量检查prompt.md` - 质量检查阶段的prompt

**整理方案**:
- 将prompts/整体移动到 `历史尝试归档/00_根目录旧文件/prompts原始版本/`
- 将根目录的新prompt.md和质量检查prompt.md也移入
- 在各个尝试文件夹中，创建软链接或README说明使用了哪个prompt版本

### 第6步: 合并重复文件夹

**发现的重复文件夹**:
1. `02_第二次尝试_对比生成` vs `02_对比生成尝试`
2. `03_第三次尝试_保留原文` vs `03_增强生成_包含原文`
3. `04_第四次尝试_详细问题` vs `04_详细题目生成`
4. `05_第五次尝试_洞察生成` vs `05_洞察生成`
5. `06_第五次尝试_洞察生成专业版` vs `06_DeepSeek英文生成` ⚠️ 名称不一致，需要确认

**合并策略**:
1. **保留标准名称**: `0X_第X次尝试_描述`
2. **合并内容**: 检查非标准名称文件夹中的文件
3. **移动独有文件**: 将非标准文件夹中的独有文件移动到标准文件夹
4. **删除空文件夹**: 确认无遗漏后删除非标准文件夹
5. **特殊处理06**: `06_DeepSeek英文生成`可能是不同的尝试，需要重命名或合并

**具体执行**:

#### 合并02 (对比生成):
```powershell
# 检查两个文件夹的差异
Compare-Object (ls "02_第二次尝试_对比生成" -Recurse -File) (ls "02_对比生成尝试" -Recurse -File) -Property Name

# 移动独有文件
Move-Item "02_对比生成尝试/*" "02_第二次尝试_对比生成/"

# 删除空文件夹
Remove-Item "02_对比生成尝试"
```

#### 合并03 (保留原文):
```powershell
# 同上流程
Compare-Object ...
Move-Item "03_增强生成_包含原文/*" "03_第三次尝试_保留原文/"
Remove-Item "03_增强生成_包含原文"
```

#### 合并04 (详细问题):
```powershell
# 同上流程 + 移动question_all到这里
Move-Item "04_详细题目生成/*" "04_第四次尝试_详细问题/"
Move-Item "../../question_all" "04_第四次尝试_详细问题/题目数据/"
Move-Item "../../question_all_md" "04_第四次尝试_详细问题/题目数据_md格式/"
Remove-Item "04_详细题目生成"
```

#### 合并05 (洞察生成):
```powershell
# 同上流程
Move-Item "05_洞察生成/*" "05_第五次尝试_洞察生成/"
Remove-Item "05_洞察生成"
```

#### 处理06 (需要确认):
- `06_第五次尝试_洞察生成专业版` - 洞察生成的专业版（milestone1_insights_pro_generator.py）
- `06_DeepSeek英文生成` - DeepSeek英文生成实验（deepseek_english_generator.py）

**用户确认**: 这两个**确实不是一次**尝试！
- 洞察专业版在前（第06次尝试）
- 英文生成在后（发现中文题不适用后紧急改的，应该是第07次）

**处理方案**:
- 重命名 `06_DeepSeek英文生成` → `07_DeepSeek英文生成`
- 保留 `06_第五次尝试_洞察生成专业版` （已是标准名称）

```powershell
# 重命名06_DeepSeek英文生成为07
Move-Item "06_DeepSeek英文生成" "07_DeepSeek英文生成"
```

### 第7步: 移动辅助脚本到对应尝试

### 第7步: 移动辅助脚本到对应尝试

根据前面的分析，将13个脚本移动到对应位置:

#### 移动到04_第四次尝试_详细问题/辅助脚本/:
- batch_auto_run.py
- run_full_batch.py
- run_batch_detail_q.py
- batch_restart.py
- monitor_batch.py
- test_batch_2files.py

#### 移动到04_第四次尝试_详细问题/数据工具/:
- consolidate_and_complete.py (合并工具)
- analyze_questions.py (统计工具)
- extract_questions_to_md.py (导出工具)

#### 移动到00_根目录旧文件/我们的整理脚本/:
- archive_history.py (旧版归档，805行)
- archive_history_complete.py (新版归档，820行)
- organize_root.py (根目录整理，193行)
- organize_question_dirs.py (问题目录整理，111行)

---

## ⚠️ 执行前必须确认的问题

1. ~~**06文件夹问题**~~: ✅ **已确认** - 重命名为07_DeepSeek英文生成

2. **备份确认**: 是否需要在执行前创建完整备份？
   - 虽然这些操作只是移动，不删除，但为了保险可以先git commit
   - ✅ 推荐: 执行Step 2先提交当前状态

3. **Git状态**: 当前是否有未提交的更改？
   - 建议先提交当前状态，然后执行整理
   - ✅ Step 2会检查并提交

---

## 详细执行步骤 (PowerShell)

### Step 1: ~~检查06文件夹内容判断是否分开~~ ✅ 已确认

**用户确认结果**: 
- `06_第五次尝试_洞察生成专业版` 和 `06_DeepSeek英文生成` 确实是两次不同尝试
- 英文版在洞察专业版之后（因为发现中文题不适用才紧急改的）
- **操作**: 将 `06_DeepSeek英文生成` 重命名为 `07_DeepSeek英文生成`

```powershell
cd "c:\Users\13031\Desktop\workspace\distillation_generation\历史尝试归档"

# 重命名06英文为07
Rename-Item "06_DeepSeek英文生成" "07_DeepSeek英文生成"

Write-Host "✓ 06文件夹已重命名为07" -ForegroundColor Green
```

---

### Step 2: Git提交当前状态 (安全措施)

```powershell
cd "c:\Users\13031\Desktop\workspace\distillation_generation"

# 检查Git状态
git status

# 如果有未提交的更改，提交
git add .
git commit -m "docs: 整理前的快照 - 准备移动历史文件"
```

---

### Step 3: 移动辅助脚本 (13个文件)

```powershell
cd "c:\Users\13031\Desktop\workspace\distillation_generation\历史尝试归档"

# 创建目标目录
$dest04_helper = "04_第四次尝试_详细问题\辅助脚本"
$dest04_tools = "04_第四次尝试_详细问题\数据工具"
$dest_organize = "00_根目录旧文件\我们的整理脚本"

New-Item -ItemType Directory -Path $dest04_helper -Force
New-Item -ItemType Directory -Path $dest04_tools -Force
New-Item -ItemType Directory -Path $dest_organize -Force

# 移动到04详细问题/辅助脚本 (6个)
Move-Item "00_根目录旧文件\辅助脚本\batch_auto_run.py" $dest04_helper
Move-Item "00_根目录旧文件\辅助脚本\run_full_batch.py" $dest04_helper
Move-Item "00_根目录旧文件\辅助脚本\run_batch_detail_q.py" $dest04_helper
Move-Item "00_根目录旧文件\辅助脚本\batch_restart.py" $dest04_helper
Move-Item "00_根目录旧文件\辅助脚本\monitor_batch.py" $dest04_helper
Move-Item "00_根目录旧文件\辅助脚本\test_batch_2files.py" $dest04_helper

# 移动到04详细问题/数据工具 (3个)
Move-Item "00_根目录旧文件\辅助脚本\consolidate_and_complete.py" $dest04_tools
Move-Item "00_根目录旧文件\辅助脚本\analyze_questions.py" $dest04_tools
Move-Item "00_根目录旧文件\辅助脚本\extract_questions_to_md.py" $dest04_tools

# 移动我们的整理脚本 (4个)
Move-Item "00_根目录旧文件\辅助脚本\archive_history.py" $dest_organize
Move-Item "00_根目录旧文件\辅助脚本\archive_history_complete.py" $dest_organize
Move-Item "00_根目录旧文件\辅助脚本\organize_root.py" $dest_organize
Move-Item "00_根目录旧文件\辅助脚本\organize_question_dirs.py" $dest_organize

# 删除空的辅助脚本文件夹
Remove-Item "00_根目录旧文件\辅助脚本" -Recurse -Force

Write-Host "✓ 辅助脚本移动完成" -ForegroundColor Green
```

---

### Step 4: 移动question目录 (question_all + question_all_md)

```powershell
cd "c:\Users\13031\Desktop\workspace\distillation_generation"

# 移动到04详细问题
Move-Item "question_all" "历史尝试归档\04_第四次尝试_详细问题\题目数据_question_all"
Move-Item "question_all_md" "历史尝试归档\04_第四次尝试_详细问题\题目数据_md格式"

Write-Host "✓ question目录移动完成" -ForegroundColor Green
```

---

### Step 5: 移动prompts目录

```powershell
# 创建目标目录
New-Item -ItemType Directory -Path "历史尝试归档\00_根目录旧文件\prompts原始版本" -Force

# 移动prompts整个目录的内容
Move-Item "prompts\*" "历史尝试归档\00_根目录旧文件\prompts原始版本\"
Remove-Item "prompts" -Force

# 移动根目录的2个prompt文件
Move-Item "新prompt.md" "历史尝试归档\00_根目录旧文件\prompts原始版本\"
Move-Item "质量检查prompt.md" "历史尝试归档\00_根目录旧文件\prompts原始版本\"

Write-Host "✓ prompts目录移动完成" -ForegroundColor Green
```

---

### Step 6: 合并重复文件夹 (02, 03, 04, 05)

```powershell
cd "历史尝试归档"

# 合并02 (对比生成)
if (Test-Path "02_对比生成尝试") {
    Write-Host "正在合并 02_对比生成尝试..." -ForegroundColor Yellow
    Copy-Item "02_对比生成尝试\*" "02_第二次尝试_对比生成\" -Recurse -Force
    Remove-Item "02_对比生成尝试" -Recurse -Force
    Write-Host "✓ 02 合并完成" -ForegroundColor Green
}

# 合并03 (保留原文)
if (Test-Path "03_增强生成_包含原文") {
    Write-Host "正在合并 03_增强生成_包含原文..." -ForegroundColor Yellow
    Copy-Item "03_增强生成_包含原文\*" "03_第三次尝试_保留原文\" -Recurse -Force
    Remove-Item "03_增强生成_包含原文" -Recurse -Force
    Write-Host "✓ 03 合并完成" -ForegroundColor Green
}

# 合并04 (详细问题)
if (Test-Path "04_详细题目生成") {
    Write-Host "正在合并 04_详细题目生成..." -ForegroundColor Yellow
    Copy-Item "04_详细题目生成\*" "04_第四次尝试_详细问题\" -Recurse -Force
    Remove-Item "04_详细题目生成" -Recurse -Force
    Write-Host "✓ 04 合并完成" -ForegroundColor Green
}

# 合并05 (洞察生成)
if (Test-Path "05_洞察生成") {
    Write-Host "正在合并 05_洞察生成..." -ForegroundColor Yellow
    Copy-Item "05_洞察生成\*" "05_第五次尝试_洞察生成\" -Recurse -Force
    Remove-Item "05_洞察生成" -Recurse -Force
    Write-Host "✓ 05 合并完成" -ForegroundColor Green
}

Write-Host "`n✓ 所有重复文件夹合并完成" -ForegroundColor Green
```

---

### Step 7: 最终检查

```powershell
cd "c:\Users\13031\Desktop\workspace\distillation_generation"

Write-Host "`n=== 最终检查 ===" -ForegroundColor Cyan

# 1. 检查根目录文件数量
$rootCount = (Get-ChildItem | Measure-Object).Count
Write-Host "根目录文件/文件夹数量: $rootCount (目标: ~25)" -ForegroundColor $(if ($rootCount -le 30) {"Green"} else {"Yellow"})

# 2. 检查question_all是否已移动
$questionExists = Test-Path "question_all"
Write-Host "question_all存在: $questionExists (应该为False)" -ForegroundColor $(if (-not $questionExists) {"Green"} else {"Red"})

# 3. 检查prompts是否已移动
$promptsExists = Test-Path "prompts"
Write-Host "prompts存在: $promptsExists (应该为False)" -ForegroundColor $(if (-not $promptsExists) {"Green"} else {"Red"})

# 4. 检查历史归档结构
Write-Host "`n历史尝试归档目录:" -ForegroundColor Cyan
Get-ChildItem "历史尝试归档" -Directory | Where-Object { $_.Name -match "^\d{2}_" } | Sort-Object Name | ForEach-Object {
    $fileCount = (Get-ChildItem $_.FullName -Recurse -File | Measure-Object).Count
    Write-Host "  $($_.Name): $fileCount 个文件"
}

# 5. 检查辅助脚本是否移动
$helperExists = Test-Path "历史尝试归档\00_根目录旧文件\辅助脚本"
Write-Host "`n辅助脚本文件夹存在: $helperExists (应该为False)" -ForegroundColor $(if (-not $helperExists) {"Green"} else {"Red"})

Write-Host "`n✅ 整理完成！" -ForegroundColor Green
```

---

### Step 8: Git提交整理结果

```powershell
cd "c:\Users\13031\Desktop\workspace\distillation_generation"

# 添加所有更改
git add .

# 提交
git commit -m "refactor: 严谨整理历史文档

- 移动13个辅助脚本到对应尝试文件夹
- 移动question_all到04_第四次尝试_详细问题
- 移动prompts到00_根目录旧文件/prompts原始版本
- 合并02-05的重复文件夹
- 根目录从XX个文件减少到~25个核心文件

详见: 历史文档整理详细计划.md"

# 推送到GitHub (可选)
# git push origin main
```

---

## 执行清单

执行前请逐项确认:

- [x] ~~Step 1: 检查06文件夹~~ ✅ 已确认，重命名为07
- [ ] Step 2: Git提交当前状态作为快照
- [ ] Step 3: 移动13个辅助脚本
- [ ] Step 4: 移动question_all和question_all_md
- [ ] Step 5: 移动prompts目录和根目录的2个prompt文件（注意：有些prompt未使用）
- [ ] Step 6: 合并02-05的重复文件夹 + 重命名06→07
- [ ] Step 7: 最终检查 - 根目录文件数量、question_all、prompts
- [ ] Step 8: Git提交整理结果

## 下一步

**当前状态**: 整理计划已完成，06文件夹问题已确认

**用户需要决定**:
1. ✅ ~~06文件夹的处理方式~~ - 已确认重命名为07
2. 是否同意上述整理方案
3. 是否立即执行，或者自行手动执行PowerShell命令

**确认后**: 按照Step 1-8依次执行PowerShell命令（Step 1已跳过）

